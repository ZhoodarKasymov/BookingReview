@model List<SelectListItem>

@{
    ViewData["Title"] = "Главная страница";
}

@Html.AntiForgeryToken()

<div id="full-wrapper">
    <div class="row">
        <div class="col-12 mb-2 p-0">
            <div class="col-4 mx-auto text-talon">
                Введите номер Вашего талона
            </div>
        </div>
    
        <div class="col-sm-4 mx-auto p-0">
            <input data-kioskboard-specialcharacters="true" autocomplete="off" id="talon" type="text" style="text-transform: uppercase" class="form-control number-talon text-center custom-input-gns validate-input talon-keyboard"/>
        </div>
    </div>
    
    <div class="row mt-5 mb-5 review-wrapper">
        <div class="col-12">
    
            <div class="col-6 mx-auto">
                <div class="row mt-5" id="card-wrapper">
                    @foreach (var review in Model)
                    {
                        <div class="col-6 mb-4">
                            <div class="card-review p-4 text-center" data-id="@review.Value" data-bad="@review.Text.Contains("Плохо")">
                                @if (review.Text.Contains("Отлично"))
                                {
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none">
                                        <g clip-path="url(#clip0_1176_1052)">
                                            <path d="M15 2.5C21.9037 2.5 27.5 8.09625 27.5 15C27.5 21.9037 21.9037 27.5 15 27.5C8.09625 27.5 2.5 21.9037 2.5 15C2.5 8.09625 8.09625 2.5 15 2.5ZM15 5C12.3478 5 9.8043 6.05357 7.92893 7.92893C6.05357 9.8043 5 12.3478 5 15C5 17.6522 6.05357 20.1957 7.92893 22.0711C9.8043 23.9464 12.3478 25 15 25C17.6522 25 20.1957 23.9464 22.0711 22.0711C23.9464 20.1957 25 17.6522 25 15C25 12.3478 23.9464 9.8043 22.0711 7.92893C20.1957 6.05357 17.6522 5 15 5ZM18.9587 15C20.2237 15 21.25 16.025 21.25 17.2913V17.5C21.25 19.1576 20.5915 20.7473 19.4194 21.9194C18.2473 23.0915 16.6576 23.75 15 23.75C13.3424 23.75 11.7527 23.0915 10.5806 21.9194C9.40848 20.7473 8.75 19.1576 8.75 17.5V17.2913C8.75 16.0262 9.775 15 11.0413 15H18.9587ZM18.75 17.5H11.25C11.25 18.4946 11.6451 19.4484 12.3483 20.1517C13.0516 20.8549 14.0054 21.25 15 21.25C15.9946 21.25 16.9484 20.8549 17.6517 20.1517C18.3549 19.4484 18.75 18.4946 18.75 17.5ZM11.25 8.75C11.5562 8.75004 11.8517 8.86244 12.0805 9.06589C12.3093 9.26934 12.4554 9.54969 12.4913 9.85375L12.5 10V12.5C12.4996 12.8186 12.3777 13.125 12.1589 13.3567C11.9402 13.5884 11.6413 13.7278 11.3233 13.7465C11.0052 13.7651 10.692 13.6617 10.4477 13.4572C10.2034 13.2527 10.0464 12.9626 10.0087 12.6462L10 12.5V10C10 9.66848 10.1317 9.35054 10.3661 9.11612C10.6005 8.8817 10.9185 8.75 11.25 8.75ZM17.8663 9.11625C18.0912 8.89207 18.393 8.76191 18.7105 8.75221C19.0279 8.74252 19.3371 8.85402 19.5753 9.06406C19.8136 9.2741 19.9629 9.56694 19.993 9.88309C20.0231 10.1992 19.9318 10.515 19.7375 10.7662L19.6337 10.8837L19.2675 11.25L19.6337 11.6163C19.8579 11.8412 19.9881 12.143 19.9978 12.4605C20.0075 12.7779 19.896 13.0871 19.6859 13.3253C19.4759 13.5636 19.1831 13.7129 18.8669 13.743C18.5508 13.7731 18.235 13.6818 17.9838 13.4875L17.8663 13.3837L16.6163 12.1337C16.401 11.9185 16.2717 11.6321 16.2526 11.3284C16.2335 11.0246 16.3259 10.7243 16.5125 10.4838L16.6163 10.3663L17.8663 9.11625Z" fill="white"/>
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1176_1052">
                                                <rect width="30" height="30" fill="white"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                }
                                else if (review.Text.Contains("Хорошо"))
                                {
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none">
                                        <g clip-path="url(#clip0_1176_1056)">
                                            <path d="M15 2.5C21.9037 2.5 27.5 8.09625 27.5 15C27.5 21.9037 21.9037 27.5 15 27.5C8.09625 27.5 2.5 21.9037 2.5 15C2.5 8.09625 8.09625 2.5 15 2.5ZM15 5C12.3478 5 9.8043 6.05357 7.92893 7.92893C6.05357 9.8043 5 12.3478 5 15C5 17.6522 6.05357 20.1957 7.92893 22.0711C9.8043 23.9464 12.3478 25 15 25C17.6522 25 20.1957 23.9464 22.0711 22.0711C23.9464 20.1957 25 17.6522 25 15C25 12.3478 23.9464 9.8043 22.0711 7.92893C20.1957 6.05357 17.6522 5 15 5ZM18.5 17.3213C18.6166 17.2036 18.7555 17.1103 18.9085 17.0468C19.0615 16.9833 19.2255 16.9508 19.3912 16.9513C19.5569 16.9517 19.7208 16.9851 19.8734 17.0495C20.026 17.1138 20.1644 17.2079 20.2803 17.3262C20.3963 17.4445 20.4876 17.5846 20.5489 17.7385C20.6103 17.8924 20.6404 18.0569 20.6376 18.2226C20.6347 18.3882 20.599 18.5516 20.5325 18.7033C20.466 18.855 20.3699 18.992 20.25 19.1063C18.8492 20.4822 16.9635 21.2522 15 21.25C13.0365 21.2522 11.1508 20.4822 9.75 19.1063C9.51879 18.873 9.38866 18.5581 9.38775 18.2297C9.38685 17.9013 9.51523 17.5857 9.74516 17.3512C9.97508 17.1166 10.2881 16.982 10.6164 16.9764C10.9448 16.9708 11.2622 17.0947 11.5 17.3213C12.4335 18.239 13.6909 18.7523 15 18.75C16.3625 18.75 17.5962 18.2063 18.5 17.3213ZM10.625 10C11.1223 10 11.5992 10.1975 11.9508 10.5492C12.3025 10.9008 12.5 11.3777 12.5 11.875C12.5 12.3723 12.3025 12.8492 11.9508 13.2008C11.5992 13.5525 11.1223 13.75 10.625 13.75C10.1277 13.75 9.6508 13.5525 9.29917 13.2008C8.94754 12.8492 8.75 12.3723 8.75 11.875C8.75 11.3777 8.94754 10.9008 9.29917 10.5492C9.6508 10.1975 10.1277 10 10.625 10ZM19.375 10C19.8723 10 20.3492 10.1975 20.7008 10.5492C21.0525 10.9008 21.25 11.3777 21.25 11.875C21.25 12.3723 21.0525 12.8492 20.7008 13.2008C20.3492 13.5525 19.8723 13.75 19.375 13.75C18.8777 13.75 18.4008 13.5525 18.0492 13.2008C17.6975 12.8492 17.5 12.3723 17.5 11.875C17.5 11.3777 17.6975 10.9008 18.0492 10.5492C18.4008 10.1975 18.8777 10 19.375 10Z" fill="white"/>
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1176_1056">
                                                <rect width="30" height="30" fill="white"/>
                                            </clipPath>
                                        </defs>
                                    </svg>
                                }
                                else if (review.Text.Contains("Удовлетворительно"))
                                {
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none">
                                        <path d="M13.4167 12.4167C13.4167 12.6219 13.3763 12.825 13.2977 13.0146C13.2192 13.2042 13.1041 13.3764 12.959 13.5215C12.8139 13.6666 12.6417 13.7817 12.4521 13.8602C12.2625 13.9388 12.0594 13.9792 11.8542 13.9792C11.649 13.9792 11.4458 13.9388 11.2562 13.8602C11.0667 13.7817 10.8944 13.6666 10.7493 13.5215C10.6042 13.3764 10.4891 13.2042 10.4106 13.0146C10.3321 12.825 10.2917 12.6219 10.2917 12.4167C10.2917 12.0023 10.4563 11.6048 10.7493 11.3118C11.0423 11.0188 11.4398 10.8542 11.8542 10.8542C12.2686 10.8542 12.666 11.0188 12.959 11.3118C13.252 11.6048 13.4167 12.0023 13.4167 12.4167ZM19.1458 13.9792C19.5602 13.9792 19.9577 13.8145 20.2507 13.5215C20.5437 13.2285 20.7083 12.8311 20.7083 12.4167C20.7083 12.0023 20.5437 11.6048 20.2507 11.3118C19.9577 11.0188 19.5602 10.8542 19.1458 10.8542C18.7314 10.8542 18.334 11.0188 18.041 11.3118C17.748 11.6048 17.5833 12.0023 17.5833 12.4167C17.5833 12.8311 17.748 13.2285 18.041 13.5215C18.334 13.8145 18.7314 13.9792 19.1458 13.9792ZM11.3333 16.5833C11.0571 16.5833 10.7921 16.6931 10.5968 16.8884C10.4014 17.0838 10.2917 17.3487 10.2917 17.625C10.2917 17.9013 10.4014 18.1662 10.5968 18.3616C10.7921 18.5569 11.0571 18.6667 11.3333 18.6667H19.6667C19.9429 18.6667 20.2079 18.5569 20.4032 18.3616C20.5986 18.1662 20.7083 17.9013 20.7083 17.625C20.7083 17.3487 20.5986 17.0838 20.4032 16.8884C20.2079 16.6931 19.9429 16.5833 19.6667 16.5833H11.3333ZM15.5 2C17.1415 2 18.767 2.32332 20.2835 2.95151C21.8001 3.57969 23.1781 4.50043 24.3388 5.66116C25.4996 6.8219 26.4203 8.19989 27.0485 9.71646C27.6767 11.233 28 12.8585 28 14.5C28 16.1415 27.6767 17.767 27.0485 19.2835C26.4203 20.8001 25.4996 22.1781 24.3388 23.3388C23.1781 24.4996 21.8001 25.4203 20.2835 26.0485C18.767 26.6767 17.1415 27 15.5 27C12.1848 27 9.00537 25.683 6.66116 23.3388C4.31696 20.9946 3 17.8152 3 14.5C3 11.1848 4.31696 8.00537 6.66116 5.66116C9.00537 3.31696 12.1848 2 15.5 2ZM15.5 4.08333C12.7373 4.08333 10.0878 5.1808 8.1343 7.1343C6.1808 9.08781 5.08333 11.7373 5.08333 14.5C5.08333 17.2627 6.1808 19.9122 8.1343 21.8657C10.0878 23.8192 12.7373 24.9167 15.5 24.9167C18.2627 24.9167 20.9122 23.8192 22.8657 21.8657C24.8192 19.9122 25.9167 17.2627 25.9167 14.5C25.9167 11.7373 24.8192 9.08781 22.8657 7.1343C20.9122 5.1808 18.2627 4.08333 15.5 4.08333Z" fill="white"/>
                                    </svg>
                                }
                                else if (review.Text.Contains("Плохо"))
                                {
                                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" fill="none">
                                        <path d="M28 14.5C28 12.8585 27.6767 11.233 27.0485 9.71646C26.4203 8.19989 25.4996 6.8219 24.3388 5.66117C23.1781 4.50043 21.8001 3.57969 20.2835 2.95151C18.767 2.32332 17.1415 2 15.5 2C13.8585 2 12.233 2.32332 10.7165 2.95151C9.19989 3.57969 7.8219 4.50043 6.66116 5.66117C5.50043 6.8219 4.57969 8.19989 3.95151 9.71646C3.32332 11.233 3 12.8585 3 14.5C3 17.8152 4.31696 20.9946 6.66116 23.3388C9.00537 25.683 12.1848 27 15.5 27C18.8152 27 21.9946 25.683 24.3388 23.3388C26.683 20.9946 28 17.8152 28 14.5ZM5.08333 14.5C5.08333 11.7373 6.1808 9.08781 8.1343 7.1343C10.0878 5.1808 12.7373 4.08333 15.5 4.08333C18.2627 4.08333 20.9122 5.1808 22.8657 7.1343C24.8192 9.08781 25.9167 11.7373 25.9167 14.5C25.9167 17.2627 24.8192 19.9122 22.8657 21.8657C20.9122 23.8192 18.2627 24.9167 15.5 24.9167C12.7373 24.9167 10.0878 23.8192 8.1343 21.8657C6.1808 19.9122 5.08333 17.2627 5.08333 14.5ZM13.4167 11.8958C13.4167 12.101 13.3763 12.3042 13.2977 12.4938C13.2192 12.6833 13.1041 12.8556 12.959 13.0007C12.8139 13.1458 12.6417 13.2609 12.4521 13.3394C12.2625 13.4179 12.0594 13.4583 11.8542 13.4583C11.649 13.4583 11.4458 13.4179 11.2562 13.3394C11.0667 13.2609 10.8944 13.1458 10.7493 13.0007C10.6042 12.8556 10.4891 12.6833 10.4106 12.4938C10.3321 12.3042 10.2917 12.101 10.2917 11.8958C10.2917 11.4814 10.4563 11.084 10.7493 10.791C11.0423 10.498 11.4398 10.3333 11.8542 10.3333C12.2686 10.3333 12.666 10.498 12.959 10.791C13.252 11.084 13.4167 11.4814 13.4167 11.8958ZM20.7083 11.8958C20.7083 12.3102 20.5437 12.7077 20.2507 13.0007C19.9577 13.2937 19.5602 13.4583 19.1458 13.4583C18.7314 13.4583 18.334 13.2937 18.041 13.0007C17.748 12.7077 17.5833 12.3102 17.5833 11.8958C17.5833 11.4814 17.748 11.084 18.041 10.791C18.334 10.498 18.7314 10.3333 19.1458 10.3333C19.5602 10.3333 19.9577 10.498 20.2507 10.791C20.5437 11.084 20.7083 11.4814 20.7083 11.8958ZM11.6083 20.3792C13.5354 18.0958 17.4625 18.0958 19.3917 20.3792C19.4778 20.4899 19.5853 20.5821 19.7079 20.6503C19.8305 20.7184 19.9656 20.7611 20.1051 20.7758C20.2446 20.7905 20.3856 20.7768 20.5197 20.7357C20.6538 20.6945 20.7782 20.6267 20.8854 20.5363C20.9927 20.4459 21.0806 20.3348 21.1438 20.2096C21.2071 20.0844 21.2444 19.9477 21.2535 19.8078C21.2627 19.6678 21.2435 19.5274 21.197 19.3951C21.1506 19.2627 21.0779 19.1411 20.9833 19.0375C18.2229 15.7667 12.775 15.7667 10.0167 19.0375C9.92209 19.1411 9.8494 19.2627 9.80297 19.3951C9.75654 19.5274 9.73732 19.6678 9.74646 19.8078C9.7556 19.9477 9.79292 20.0844 9.85617 20.2096C9.91942 20.3348 10.0073 20.4459 10.1146 20.5363C10.2218 20.6267 10.3462 20.6945 10.4803 20.7357C10.6144 20.7768 10.7554 20.7905 10.8949 20.7758C11.0344 20.7611 11.1695 20.7184 11.2921 20.6503C11.4147 20.5821 11.5222 20.4899 11.6083 20.3792Z" fill="white"/>
                                    </svg>
                                }
    
                                <p>@review.Text</p>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    
        <div class="col-12">
            <div class="col-6 mx-auto">
                <div class="col-12">
                    <textarea maxlength="256"
                            data-kioskboard-specialcharacters="true"
                            placeholder="Комментарии не обязательны"
                            class="form-control custom-input-gns custom-text-area keyboard"></textarea>
                </div>
            </div>
        </div>
    
        <div class="col-12">
            <div class="d-flex justify-content-center">
                <button class="btn custom-button" id="validateButton">Отправить отзыв</button>
            </div>
        </div>
    
    </div>
</div>

@section Scripts
{
    <script type="text/javascript">
        var dataId;
        var isBadReview;
        
        $('.card-review').click(function() {
              $('.card-review').removeClass('active-review');
              $(this).addClass('active-review');
              isBadReview = $(this).attr('data-bad');
              dataId = $(this).attr('data-id');
              
              if (isBadReview === "True") {
                  $('#card-wrapper div').remove();
                  $('#card-wrapper').append($(`<div class="col-6 mb-4">
                                                   <div class="card-bad-review p-4 text-center">
                                                       <input class="custom-check-box" type="checkbox" id="myCheckbox" name="myCheckbox" value="Грубое отношение">
                                                       <label for="myCheckbox" class="check-box-label">Грубое отношение</label>
                                                   </div>
                                               </div>
                                               <div class="col-6 mb-4">
                                                   <div class="card-bad-review p-4 text-center">
                                                       <input class="custom-check-box" type="checkbox" id="myCheckbox2" name="myCheckbox" value="Отвлекается на телефонные звонки, коллег">
                                                       <label for="myCheckbox2" class="check-box-label">Отвлекается на телефонные звонки, коллег</label>
                                                   </div>
                                               </div>
                                               <div class="col-6 mb-4">
                                                   <div class="card-bad-review p-4 text-center">
                                                       <input class="custom-check-box" type="checkbox" id="myCheckbox3" name="myCheckbox" value="Некомпетентный сотрудник">
                                                       <label for="myCheckbox3" class="check-box-label">Некомпетентный сотрудник</label>
                                                   </div>
                                               </div>
                                               <div class="col-6 mb-4">
                                                   <div class="card-bad-review p-4 text-center">
                                                       <input class="custom-check-box" type="checkbox" id="myCheckbox4" name="myCheckbox" value="Долго обслуживает">
                                                       <label for="myCheckbox4" class="check-box-label">Долго обслуживает</label>
                                                   </div>
                                               </div>`));
              }
        });
        
        $('#validateButton').click(function(){      
            let comment = $('.custom-text-area').val();
            let talon = $('#talon').val();
            let message = $('.error-message');
            
            if (talon && message.length === 0) {
                if (!dataId){
                    dangerAlert("Выберите отзыв перед отправкой!");
                    return;
                }
                
                let comments = comment !== "" ? [comment] : [];
                
                if (isBadReview === "True"){
                    $('input[type="checkbox"]:checked').each(function() {
                        comments.push($(this).val());
                    });
                }
                
                showLoader();
                let token = $("input[name='__RequestVerificationToken']").val();
                
                $.ajax({
                   url: '@Url.Action("AddReview", "Home")',
                   type: 'POST',
                   data: { id: dataId, comments: comments, talon: talon },
                   beforeSend: function(xhr) {
                     xhr.setRequestHeader("RequestVerificationToken", token);
                   },
                   success: function(response) {
                       if (response){
                           $('#full-wrapper div').remove();
                           $('#full-wrapper').append($(`<h3 class="row text-center w-100">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50" fill="none">
                                                            <g clip-path="url(#clip0_1167_1044)">
                                                                <path d="M25 0C31.6304 0 37.9893 2.63392 42.6777 7.32233C47.3661 12.0107 50 18.3696 50 25C50 31.6304 47.3661 37.9893 42.6777 42.6777C37.9893 47.3661 31.6304 50 25 50C18.3696 50 12.0107 47.3661 7.32233 42.6777C2.63392 37.9893 0 31.6304 0 25C0 18.3696 2.63392 12.0107 7.32233 7.32233C12.0107 2.63392 18.3696 0 25 0ZM21.8857 29.9321L16.3321 24.375C16.133 24.1759 15.8967 24.018 15.6366 23.9102C15.3764 23.8025 15.0976 23.747 14.8161 23.747C14.5345 23.747 14.2557 23.8025 13.9956 23.9102C13.7355 24.018 13.4991 24.1759 13.3 24.375C12.8979 24.7771 12.672 25.3224 12.672 25.8911C12.672 26.4597 12.8979 27.0051 13.3 27.4071L20.3714 34.4786C20.57 34.6787 20.8061 34.8375 21.0663 34.9459C21.3265 35.0542 21.6056 35.11 21.8875 35.11C22.1694 35.11 22.4485 35.0542 22.7087 34.9459C22.9689 34.8375 23.205 34.6787 23.4036 34.4786L38.0464 19.8321C38.2482 19.6339 38.4087 19.3976 38.5187 19.137C38.6287 18.8764 38.686 18.5966 38.6873 18.3137C38.6886 18.0309 38.6339 17.7505 38.5263 17.4889C38.4188 17.2273 38.2605 16.9896 38.0606 16.7894C37.8607 16.5893 37.6231 16.4307 37.3616 16.3228C37.1001 16.215 36.8199 16.1599 36.537 16.1609C36.2542 16.1619 35.9743 16.2189 35.7135 16.3286C35.4528 16.4383 35.2164 16.5985 35.0179 16.8L21.8857 29.9321Z" fill="#0F9197"/>
                                                            </g>
                                                            <defs>
                                                                <clipPath id="clip0_1167_1044">
                                                                    <rect width="50" height="50" fill="white"/>
                                                                </clipPath>
                                                            </defs>
                                                        </svg>
                                                        <p class="mt-3">Отправлено!</p>
                                                    </h3>                                                    
                                                    <h1 class="row text-center w-100 mt-5 pt-5">
                                                        <p>Спасибо за отзыв!</p>
                                                    </h1>`));
                       }
                   },
                   error: function(xhr) {
                       dangerAlert(xhr.responseText);
                   },
                   complete: function() {
                       hideLoader();
                   }
              });   
            }            
        });
    </script>
}